## 前端项目代码规范搭建

代码规范是前端工程化中很重要的一环，这里对前端项目中代码规范的搭建做了一个总结

代码规范的搭建会使用到以下依赖：

> - Eslint
> - Prettier
> - Husky
> - Lint-Staged
> - CommitLint
> - StyleLint

大体的思路是：使用 `Eslint`做开发时的代码检查，使用Husky激活 `GitHooks`。配合 `Prettier`、`Lint-Staged`等依赖来做提交时的代码格式化和 `Commit`信息规范化

## 配置Eslint

这里采用腾讯的[eslint-config-alloy](https://github.com/AlloyTeam/eslint-config-alloy)规范，笔记中使用的是`Typescript React`规则，更多规则可以查看[Git文档](https://github.com/AlloyTeam/eslint-config-alloy/blob/master/README.zh-CN.md#typescript-react)

- 安装依赖

```bash
npm install --save-dev eslint typescript @typescript-eslint/parser @typescript-eslint/eslint-plugin eslint-plugin-react eslint-config-alloy
```

在你的项目根目录创建一个`.eslintrc.js`文件，并将以下内容复制进去：

```js
module.exports = {
  extends: [
    'alloy',
    'alloy/react',
    'alloy/typescript',
  ],
  env: {
    // 你的环境变量（包含多个预定义的全局变量）
    //
    // browser: true,
    // node: true,
    // mocha: true,
    // jest: true,
    // jquery: true
  },
  globals: {
    // 你的全局变量（设置为 false 表示它不允许被重新赋值）
    //
    // myGlobal: false
  },
  rules: {
    // 自定义你的规则
  },
};
```

重启编辑器即可生效，可以查看[官方示例](https://alloyteam.github.io/eslint-config-alloy/)知道哪些代码是错误的。

## git规范

> git提供了很多Hooks，可以让我们在不同的阶段对代码进行不同的操作，控制提交到仓库的代码的规范性和准确性。husky是操作Git Hooks的工具，和它类似的工具还有yorkie

- pre-commit: 预提交，由git commit命令调用，可以通过`--no-verify`参数绕过调用pre-commit。通常用于在提交代码前，进行代码规范检查。
- commit-message: 通常用于commit信息的校检

### 配置过程

- 安装husky lint-staged

```bash
yarn add lint-staged husky -D

npm set-script prepare "husky install" # 在package.json中添加脚本

git init // 初始化git仓库，注意这个必须要在初始化husky之前

yarn prepare # 初始化husky,将 git hooks 钩子交由,husky执行
```

#### 配置pre-commit

```bash
npx husky add .husky/pre-commit "npx lint-staged"
```

在package.json文件中填写以下规则

```json
  "lint-staged": {
    "**/*.{js?(x),ts?(x)}": [
      "eslint . --fix",
      "prettier --write ."
    ]
  },
```

#### 配置commit-msg

```bash
yarn add commitlint @commitlint/config-conventional -D
npx husky add .husky/commit-msg 'npx --no-install commitlint --edit "$1"' # 创建commit-msg
```

> **注:** 如果执行创建commit-msg命令时不成功，可以先执行`npx husky add .husky/commit-msg`，会在.husky目录下生成一个commit-msg文件，然后将`npx --no-install commitlint --edit $1`复制到该文件中替换`undefined`。

在项目根目录创建`commitlint.config.js`文件

```js
module.exports = {
  extends: ['@commitlint/config-conventional']
}
```

@commitlint/config-conventional用来规定commit信息的提交规范。默认采用`Angular`规范

#### 配置stylelint

- 安装依赖

```bash
yarn add stylelint stylelint-config-prettier stylelint-config-standard -D
```

在项目根目录创建`.stylelintrc.js`文件

```js
module.exports = {
  extends: ['stylelint-config-standard', 'stylelint-config-prettier']
}

```

添加`lint-staged`规则

```json
 "lint-staged": {
    "**/*.{less,scss,sass}": [
      "stylelint --fix",
      "prettier --write ."
    ],
    "**/*.{js?(x),ts?(x)}": [
      "eslint . --fix",
      "prettier --write ."
    ]
  },
```
